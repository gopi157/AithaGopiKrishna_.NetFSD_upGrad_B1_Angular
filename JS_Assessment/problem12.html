<!DOCTYPE html>
<html>
<head>
    <title>Location Based Weather Logger</title>
    <style>
        body { font-family: Arial; }
        button { padding: 8px 15px; margin: 10px 0; }
        #history div {
            border: 1px solid gray;
            padding: 8px;
            margin: 5px 0;
        }
    </style>
</head>
<body>

<h2>Location-Based Weather Logger</h2>

<button onclick="getLocation()">Get My Location</button>

<p id="status" style="color:red;"></p>

<h3>Location History</h3>
<div id="history"></div>

<script>

    // Load history on page load
    window.onload = function() {
        displayHistory();
    };

    function getLocation() {

        if (!navigator.geolocation) {
            document.getElementById("status").innerText =
                "Geolocation is not supported by your browser.";
            return;
        }

        navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
    }

    // ✅ Success Callback
    function successCallback(position) {

        let latitude = position.coords.latitude;
        let longitude = position.coords.longitude;

        document.getElementById("status").innerText =
            `Latitude: ${latitude}, Longitude: ${longitude}`;

        // Get existing history
        let locationHistory =
            JSON.parse(localStorage.getItem("locations")) || [];

        // Add new location with timestamp
        locationHistory.unshift({
            lat: latitude,
            long: longitude,
            time: new Date().toLocaleString()
        });

        // Keep only last 5 entries
        if (locationHistory.length > 5) {
            locationHistory.pop();
        }

        // Store in localStorage
        localStorage.setItem("locations",
            JSON.stringify(locationHistory));

        displayHistory();
    }

    // ✅ Error Callback
    function errorCallback(error) {

        switch (error.code) {
            case error.PERMISSION_DENIED:
                document.getElementById("status").innerText =
                    "Permission Denied by user.";
                break;

            case error.TIMEOUT:
                document.getElementById("status").innerText =
                    "Location request timed out.";
                break;

            case error.POSITION_UNAVAILABLE:
                document.getElementById("status").innerText =
                    "Location information unavailable.";
                break;

            default:
                document.getElementById("status").innerText =
                    "An unknown error occurred.";
        }
    }

    function displayHistory() {

        let historyDiv = document.getElementById("history");
        historyDiv.innerHTML = "";

        let locationHistory =
            JSON.parse(localStorage.getItem("locations")) || [];

        locationHistory.forEach(function(entry) {
            let div = document.createElement("div");
            div.innerText =
                `Latitude: ${entry.lat}, Longitude: ${entry.long}
Time: ${entry.time}`;
            historyDiv.appendChild(div);
        });
    }

</script>

</body>
</html>